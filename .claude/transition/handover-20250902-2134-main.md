# [Handoff] "handover is running…" — 2025-09-02 21:34 (branch: main)

## Goal / Scope
- **やること**: AWS Cost NotifierプロジェクトのTerraform設定とアーキテクチャ改善、CLAUDE.md全面書き換え
- **やらないこと**: Lambda関数の業務ロジック変更、GitHub Actions追加開発

## Key decisions
- **採用**: EventBridge Scheduler → JSTタイムゾーン対応、ARM64 Lambda、pyproject.toml+uv パッケージ管理
- **採用**: EventBridge Scheduler Group → スケジュール管理の論理グループ化
- **採用**: LOG_LEVEL環境変数 → 動的ログレベル制御
- **却下**: EventBridge Rule → Schedulerの上位互換のため廃止

## Done / Pending
### ✅ Done
- EventBridge Rule → Scheduler移行（JST対応）
- Terraform変数バリデーション修正（log_level）
- outputs.tf更新（Scheduler対応）
- terraform.tfvars.exampleのtypo修正
- pyproject.tomlパッケージ検索設定追加
- Lambda関数のLOG_LEVEL環境変数対応実装
- CLAUDE.md全面書き換え（現状反映）

### ⏳ Pending
- なし（主要タスク完了）

## Next actions
1. `terraform validate && terraform plan`でTerraform設定確認
2. 実際のAWS環境でEventBridge Scheduler動作テスト
3. JSTタイムゾーンでの正確な実行時刻確認
4. Lambda関数でLOG_LEVEL変更テスト実行
5. Discord通知の正常動作確認

## Affected files
- `terraform/main.tf:147-208` - EventBridge Scheduler設定
- `terraform/variables.tf:39` - log_level バリデーション修正
- `terraform/outputs.tf:13-21` - Scheduler対応出力
- `terraform/terraform.tfvars.example:4,7` - リージョンtypo、クォート修正
- `lambda/lambda_function.py:14-15` - LOG_LEVEL環境変数対応
- `pyproject.toml:32-34` - setuptools パッケージ設定
- `CLAUDE.md` - 全面書き換え（技術スタック・構成更新）

## Affected symbols
- `aws_scheduler_schedule.cost_notification_schedule` - 新規Schedulerリソース
- `aws_scheduler_schedule_group.cost_notification_group` - 新規Schedulerグループ
- `aws_iam_role.eventbridge_scheduler_role` - 新規Scheduler用IAMロール
- 削除: `aws_cloudwatch_event_rule.cost_notification_schedule`

## Repro / Commands
```bash
# Terraform設定確認
cd terraform && terraform validate && terraform plan

# Lambda関数でログレベルテスト
# terraform.tfvarsでlog_level = "DEBUG"に変更後apply
```

## Risks / Unknowns
- **リスク**: EventBridge Scheduler料金がRuleより高い可能性
- **検証**: 初回デプロイ後にコスト監視で確認
- **リスク**: ARM64 Lambda依存関係の互換性問題
- **検証**: `uv pip install`コマンドでパッケージ動作確認

## Links
- AWS EventBridge Scheduler: https://docs.aws.amazon.com/eventbridge/latest/userguide/eb-create-schedule.html
- uv Documentation: https://docs.astral.sh/uv/